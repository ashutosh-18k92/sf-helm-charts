{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "type": "object",
    "required": [ "app", "containerPort", "image", "service" ],
    "properties": {
        "app": {
            "type": "object",
            "description": "Business/Service Identity",
            "required": [ "name", "component" ],
            "properties": {
                "name": {
                    "type": "string",
                    "description": "Business service name",
                    "minLength": 1,
                    "pattern": "^[a-z0-9]([-a-z0-9]*[a-z0-9])?$"
                },
                "component": {
                    "type": "string",
                    "description": "Component type",
                    "enum": [ "api", "worker", "consumer" ]
                },
                "partOf": {
                    "type": "string",
                    "description": "Parent application/system name"
                }
            }
        },
        "environment": {
            "type": "string",
            "description": "Environment identifier"
        },
        "containerPort": {
            "type": "integer",
            "description": "Container port number",
            "minimum": 1,
            "maximum": 65535
        },
        "replicaCount": {
            "type": "integer",
            "minimum": 1,
            "maximum": 100
        },
        "image": {
            "type": "object",
            "required": [ "repository" ],
            "properties": {
                "repository": {
                    "type": "string",
                    "minLength": 1
                },
                "tag": {
                    "type": "string"
                },
                "pullPolicy": {
                    "type": "string",
                    "enum": [ "Always", "IfNotPresent", "Never" ]
                }
            }
        },
        "service": {
            "type": "object",
            "required": [ "port", "targetPort" ],
            "properties": {
                "type": {
                    "type": "string",
                    "enum": [ "ClusterIP", "NodePort", "LoadBalancer" ]
                },
                "port": {
                    "type": "integer",
                    "minimum": 1,
                    "maximum": 65535
                },
                "targetPort": {
                    "type": "integer",
                    "minimum": 1,
                    "maximum": 65535
                }
            }
        },
        "virtualService": {
            "type": "object",
            "required": [ "namespace" ],
            "properties": {
                "enabled": {
                    "type": "boolean",
                    "description": "Enable or disable VirtualService creation"
                },
                "namespace": {
                    "type": "string",
                    "description": "Namespace where the VirtualService will be created",
                    "minLength": 1,
                    "pattern": "^[a-z0-9]([-a-z0-9]*[a-z0-9])?$"
                },
                "hosts": {
                    "type": "array",
                    "description": "List of host names for the VirtualService",
                    "items": {
                        "type": "string",
                        "minLength": 1
                    }
                },
                "domain": {
                    "type": "string",
                    "description": "Domain suffix for VirtualService hosts"
                },
                "gateways": {
                    "type": "array",
                    "description": "List of gateways to attach",
                    "items": {
                        "type": "string",
                        "minLength": 1
                    }
                },
                "routes": {
                    "type": "array",
                    "description": "List of route prefixes",
                    "items": {
                        "type": "string"
                    }
                },
                "attempts": {
                    "type": "integer",
                    "description": "Number of retry attempts",
                    "minimum": 1,
                    "maximum": 10
                },
                "perTryTimeoutSeconds": {
                    "type": "integer",
                    "description": "Timeout per retry attempt in seconds",
                    "minimum": 1,
                    "maximum": 60
                },
                "retryOn": {
                    "type": "array",
                    "description": "Conditions for retry",
                    "items": {
                        "type": "string",
                        "enum": [
                            "5xx",
                            "gateway-error",
                            "reset",
                            "connect-failure",
                            "envoy-ratelimited",
                            "retriable-4xx",
                            "refused-stream",
                            "retriable-status-codes",
                            "retriable-headers",
                            "grpc-cancelled",
                            "grpc-deadline-exceeded",
                            "grpc-resource-exhausted",
                            "grpc-unavailable"
                        ]
                    }
                }
            }
        }
    }
}